//–∫–Ω–æ–ø–∫–∞ –ü—ñ–¥–Ω—è—Ç–∏—Å—å –≤ –≥–æ—Ä—É

document.getElementById('back-to-top').addEventListener('click', function(e) {
  e.preventDefault(); // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
  
  // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç header
  const headerElement = document.getElementById('header');
  
  // –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–æ header
  if (headerElement) {
    headerElement.scrollIntoView({
      behavior: 'smooth'
    });
  }
});

// –ë–£–†–ì–ï–† –ö–ù–û–ü–ö–ê

document.addEventListener('DOMContentLoaded', function() {
  const burger = document.querySelector('.burger-menu');
  const nav = document.querySelector('.nav');
  const dropdowns = document.querySelectorAll('.dropdown');

  // –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é
  burger.addEventListener('click', function() {
    this.classList.toggle('active');
    nav.classList.toggle('active');
  });

  // –ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–±–∏–ª—å–Ω–æ–µ –ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (–∏–ª–∏ —É–∑–∫–∏–π —ç–∫—Ä–∞–Ω)
  const isMobile = () => window.innerWidth <= 992;

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ –º–µ–Ω—é (—Ç–æ–ª—å–∫–æ –Ω–∞ –∫–æ–º–ø—å—é—Ç–µ—Ä–µ)
  if (!isMobile()) {
    dropdowns.forEach(dropdown => {
      const link = dropdown.querySelector('a');
      const content = dropdown.querySelector('.dropdown-content');

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
      dropdown.addEventListener('mouseenter', () => {
        content.style.display = 'block';
      });

      // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ —É—Ö–æ–¥–µ –∫—É—Ä—Å–æ—Ä–∞
      dropdown.addEventListener('mouseleave', () => {
        content.style.display = 'none';
      });

      // –û—Ç–º–µ–Ω—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ (–µ—Å–ª–∏ href="#")
      link.addEventListener('click', (e) => {
        if (link.getAttribute('href') === '#') {
          e.preventDefault();
        }
      });
    });
  }

  // –ù–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö dropdown-content –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ
  else {
    dropdowns.forEach(dropdown => {
      const link = dropdown.querySelector('a');
      const content = dropdown.querySelector('.dropdown-content');

      // –°–∫—Ä—ã–≤–∞–µ–º dropdown-content (–µ—Å–ª–∏ –≤–¥—Ä—É–≥ –±—ã–ª –≤–∏–¥–µ–Ω)
      content.style.display = 'none';

      // –û—Ç–∫–ª—é—á–∞–µ–º –∫–ª–∏–∫ –ø–æ —Å—Å—ã–ª–∫–µ (–µ—Å–ª–∏ href="#")
      link.addEventListener('click', (e) => {
        if (link.getAttribute('href') === '#') {
          e.preventDefault();
        }
      });
    });
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
  window.addEventListener('resize', () => {
    dropdowns.forEach(dropdown => {
      const content = dropdown.querySelector('.dropdown-content');
      content.style.display = 'none'; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏
    });

    // –ï—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –≤ –¥–µ—Å–∫—Ç–æ–ø–Ω—ã–π —Ä–µ–∂–∏–º ‚Äî –≤–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–∞–≤–µ–¥–µ–Ω–∏—è
    if (!isMobile()) {
      dropdowns.forEach(dropdown => {
        const content = dropdown.querySelector('.dropdown-content');

        dropdown.addEventListener('mouseenter', () => {
          content.style.display = 'block';
        });

        dropdown.addEventListener('mouseleave', () => {
          content.style.display = 'none';
        });
      });
    }
  });
});

// –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û + –§–û–†–ú–ê –û–ë–†–ê–¢–ù–û–ô –°–í–Ø–ó–ò
document.addEventListener('DOMContentLoaded', function() {
  // –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  const botToken = '7401776138:AAEIszjxs4_-9alGK01THnbG9VHvAGUrEwA';
  const adminChatIds = ['398501551', '5370980969', '5235424421'];

  // ===== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û =====
  const modal = document.getElementById('callbackModal');
  const modalForm = document.getElementById('modalForm');
  
  // –û—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
  document.querySelector('.details-hero-btn')?.addEventListener('click', function(e) {
    e.preventDefault();
    modal.style.display = 'block';
    document.body.classList.add('modal-open');
  });

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–∫–Ω–∞
  window.addEventListener('click', function(e) {
    if (e.target === modal) {
      modal.style.display = 'none';
      document.body.classList.remove('modal-open');
    }
  });

  document.querySelector('.modal-close')?.addEventListener('click', function() {
    modal.style.display = 'none';
    document.body.classList.remove('modal-open');
  });

  // ===== –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–õ–Ø –¢–ï–õ–ï–§–û–ù–ê =====
  const phoneInput = document.getElementById('modalPhone');
if (phoneInput) {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ +38 –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
  phoneInput.addEventListener('focus', function() {
    if (!this.value.startsWith('+38')) {
      this.value = '+38';
    }
  });

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
  phoneInput.addEventListener('input', function(e) {
    // –£–¥–∞–ª—è–µ–º –≤—Å—ë, –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
    let cleaned = this.value.replace(/\D/g, '');
    
    // –î–æ–±–∞–≤–ª—è–µ–º +38, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
    if (!cleaned.startsWith('38')) {
      cleaned = '38' + cleaned;
    }
    
    // –û–±—Ä–µ–∑–∞–µ–º –¥–æ 12 —Ü–∏—Ñ—Ä (38 + 10 —Ü–∏—Ñ—Ä)
    cleaned = cleaned.substring(0, 12);
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º: +38 XXX XXX XXXX (15 —Å–∏–º–≤–æ–ª–æ–≤ —Å –ø—Ä–æ–±–µ–ª–∞–º–∏)
    let formatted = '+38';
    if (cleaned.length > 2) {
      formatted += ' ' + cleaned.substring(2, 5);
    }
    if (cleaned.length > 5) {
      formatted += ' ' + cleaned.substring(5, 8);
    }
    if (cleaned.length > 8) {
      formatted += ' ' + cleaned.substring(8, 12);
    }
    
    this.value = formatted;
  });

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
  phoneInput.addEventListener('blur', function() {
    const digitsOnly = this.value.replace(/\D/g, '');
    if (!digitsOnly.startsWith('38') || digitsOnly.length < 12) {
      this.setCustomValidity('–í–≤–µ–¥–∏—Ç–µ 10 —Ü–∏—Ñ—Ä –Ω–æ–º–µ—Ä–∞ –ø–æ—Å–ª–µ +38');
    } else {
      this.setCustomValidity('');
    }
  });
}

  // ===== –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–ü–†–ê–í–ö–ò –§–û–†–ú–´ =====
  if (modalForm) {
    modalForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      console.log('–§–æ—Ä–º–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞'); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
      
      // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π
      const name = document.getElementById('modalName')?.value.trim();
      const phone = document.getElementById('modalPhone')?.value.trim();
      const vin = document.getElementById('modalVin')?.value.trim();
      const carModel = document.getElementById('modalCar')?.value.trim();

      // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      const phoneRegex = /^\+38\s?\d{3}\s?\d{3}\s?\d{4}$/;
      if (!phoneRegex.test(phone)) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +38 XXX XXX XXXX');
        return;
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
      const message = `üöó –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫:\n\n` +
                     `‚ñ™ –ò–º—è: ${name || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}\n` +
                     `‚ñ™ –¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n` +
                     `‚ñ™ VIN: ${vin || '–Ω–µ —É–∫–∞–∑–∞–Ω'}\n` +
                     `‚ñ™ –ê–≤—Ç–æ: ${carModel || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`;

      try {
        console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram:', message); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
        await sendToTelegram(message);
        
        // –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
        alert('‚úÖ –î—è–∫—É—î–º–æ! –ú–∏ –≤–∞–º –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É—î–º–æ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.');
        modalForm.reset();
        modal.style.display = 'none';
        document.body.classList.remove('modal-open');
      } catch (error) {
        console.error('–í—ñ–¥–±—É–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞:', error);
        alert('‚ö† –í—ñ–¥–±—É–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ –Ω–∞–º.');
      }
    });
  }

  // ===== –û–¢–ü–†–ê–í–ö–ê –í TELEGRAM =====
  async function sendToTelegram(message) {
    const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
    
    for (const chatId of adminChatIds) {
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          chat_id: chatId,
          text: message,
          parse_mode: 'HTML'
        })
      });
      
      if (!response.ok) {
        throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
      }
    }
  }
});



// –§–û–†–ú–ê –û–ë–†–ê–¢–ù–û–ô –°–í–Ø–ó–ò
document.addEventListener('DOMContentLoaded', function() {
  const phoneInput = document.getElementById('phoneInput');
  const callbackForm = document.getElementById('callbackForm');
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ +38 –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ
  if (phoneInput) {
    phoneInput.addEventListener('focus', function() {
      if (!this.value.startsWith('+38')) {
        this.value = '+38';
      }
    });

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–æ–¥–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    phoneInput.addEventListener('input', function(e) {
      // –£–¥–∞–ª—è–µ–º –≤—Å—ë, –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
      let cleaned = this.value.replace(/\D/g, '');
      
      // –î–æ–±–∞–≤–ª—è–µ–º +38, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
      if (!cleaned.startsWith('38')) {
        cleaned = '38' + cleaned;
      }
      
      // –û–±—Ä–µ–∑–∞–µ–º –¥–æ 12 —Ü–∏—Ñ—Ä (38 + 10 —Ü–∏—Ñ—Ä)
      cleaned = cleaned.substring(0, 12);
      
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º: +38 XXX XXX XXXX
      let formatted = '+38';
      if (cleaned.length > 2) {
        formatted += ' ' + cleaned.substring(2, 5);
      }
      if (cleaned.length > 5) {
        formatted += ' ' + cleaned.substring(5, 8);
      }
      if (cleaned.length > 8) {
        formatted += ' ' + cleaned.substring(8, 12);
      }
      
      this.value = formatted;
    });
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  if (callbackForm) {
    callbackForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('nameInput').value.trim();
      const phoneNumber = document.getElementById('phoneInput').value.trim();
      const messageText = document.getElementById('messageInput').value.trim();
      const responseMessage = document.getElementById('responseMessage');
      
      // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Ä–æ–≤–Ω–æ 10 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ +38)
      const cleanPhone = phoneNumber.replace(/\D/g, '');
      if (!cleanPhone.startsWith('38') || cleanPhone.length !== 12) {
        responseMessage.textContent = "–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É —É —Ñ–æ—Ä–º–∞—Ç—ñ +38 XXX XXX XXXX!";
        responseMessage.className = "response-message error";
        responseMessage.style.display = "block";
        return;
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è Telegram
      const telegramMessage = `üöó –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω—ã–π –∑–≤–æ–Ω–æ–∫:\n\n` +
                         `‚ñ™ –ò–º—è: ${name || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}\n` +
                         `‚ñ™ –¢–µ–ª–µ—Ñ–æ–Ω: ${phoneNumber}\n` +
                         `‚ñ™ –ê–≤—Ç–æ: ${messageText || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`;

      const botToken = '7401776138:AAEIszjxs4_-9alGK01THnbG9VHvAGUrEwA';
      const adminChatIds = ['398501551', '5370980969', '5235424421'];
      
      // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å—ã
      Promise.all(
        adminChatIds.map(chatId => 
          fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              chat_id: chatId,
              text: telegramMessage
            })
          })
        )
      )
      .then(responses => Promise.all(responses.map(res => res.json())))
      .then(data => {
        responseMessage.textContent = "–î—è–∫—É—î–º–æ! –ú–∏ –≤–∞–º –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É—î–º–æ –Ω–∞–π–±–ª–∏–∂—á–∏–º —á–∞—Å–æ–º.";
        responseMessage.className = "response-message success";
        responseMessage.style.display = "block";
        callbackForm.reset();
        
        setTimeout(() => {
          responseMessage.style.display = "none";
        }, 5000);
      })
      .catch(error => {
        console.error("–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:", error);
        responseMessage.textContent = "–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –∞–±–æ –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–π—Ç–µ –Ω–∞–º.";
        responseMessage.className = "response-message error";
        responseMessage.style.display = "block";
      });
    });
  }
});